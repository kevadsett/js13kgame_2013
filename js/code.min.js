window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}})();if(!console||!console.log){console={log:function(){}}}LateRunner.startGame=function(){console.log("LateRunner::startGame");var a=new GameModel();LateRunner.events=new Events();LateRunner.game=new GameController(a)};function Events(f){var d={},c,e,b,a=Array;f=f||this;f.on=function(h,k,g){d[h]||(d[h]=[]);d[h].push({f:k,c:g})};f.off=function(g,h){e=d[g]||[];c=e.length=h?e.length:0;while(~--c<0){h==e[c].f&&e.splice(c,1)}};f.emit=function(){b=a.apply([],arguments);e=d[b.shift()]||[];b=b[0] instanceof a&&b[0]||b;c=e.length;for(j=0;j<c;j++){e[j].f.apply(e[j].c,b)}}}function mapValue(f,e,b,d,g){var c=b-e,a=g-d;return((f-e)/c*a+d)}function rgbObjToHexColourString(b){function a(c){var d=c.toString(16);if(d.length==1){d="0"+d}return d}return"#"+a(b.r)+a(b.g)+a(b.b)}function hexColourStringToRgbObj(a){function e(f){return parseInt(f,16)}if(a.indexOf("#")!=-1){a=a.slice(1,7)}var c=a.slice(0,2),d=a.slice(2,4),b=a.slice(4,6);return{r:e(c),g:e(d),b:e(b)}}function coordinateIsWithinBounds(a,f,e,c,b,d){return a>=d&&a<c&&f>=e&&f<b}function coordinateWasTouched(b,a,d,c){return coordinateIsWithinBounds(d,c,a-LateRunner.touchRadius,b+LateRunner.touchRadius,a+LateRunner.touchRadius,b-LateRunner.touchRadius)}function randomInt(b,a){return Math.round(b+(Math.random()*(a-b)))}function padNumber(a,b){var c=""+a;while(c.length<b){c="0"+c}return c}function BossController(a){this.model=a.boss;LateRunner.events.on("update",this.update,this);LateRunner.events.on("seenByBoss",this.startTalking,this);this.setupAnimationFrames()}BossController.prototype={update:function(){if(!!this.model.talking){this.model.animIndex=(this.model.animIndex+1)%2;if(Math.random()>0.85&&this.model.animIndex==0){this.model.currentFrameIndex=(this.model.currentFrameIndex+1)%2;this.model.currentFrame=this.model.talkFrames[this.model.currentFrameIndex]}}},setupAnimationFrames:function(){this.model.imageObject.src=LateRunner.AnimData.boss.filename;this.model.standFrames=LateRunner.AnimData.boss.stand.frames;this.model.talkFrames=LateRunner.AnimData.boss.talk.frames;this.model.currentFrameIndex=0;this.model.currentFrame=this.model.standFrames[0]},startTalking:function(){this.model.currentFrame=this.model.talkFrames[0];this.model.talking=true}};function DoorAndSwitchController(a){this.model=a;LateRunner.events.on("switchActivated",this.onSwitchActivated,this)}DoorAndSwitchController.prototype={onSwitchActivated:function(a){for(i=0;i<a.connectedDoors.length;i++){this.toggleDoorState(a.connectedDoors[i])}if(this.model.currentLevel.boss){LateRunner.events.emit("seenByBoss")}},toggleDoorState:function(a){if(a.state=="closed"){a.state="open"}else{a.state="closed"}},doorIsClosedBetween:function(c,a){var d,e=[],b=this.model.currentLevel.doors;for(d=0;d<b.length;d++){if(c.x<a.x){if(b[d].position.x>=c.x&&b[d].position.x<a.x){e.push(b[d])}}else{if(c.x>a.x){if(b[d].position.x<c.x&&b[d].position.x>=a.x){e.push(b[d])}}}}for(d=0;d<e.length;d++){if(e[d].state=="closed"){return true}}return false},resetDoors:function(){var b,a=this.model.currentLevel.doors;for(b=0;b<a.length;b++){a[b].state=a[b].originalState}}};function GameController(a){this.initialise(a)}GameController.prototype={initialise:function(a){console.log("GameController::initialise");LateRunner.directions={RIGHT:1,STILL:0,LEFT:-1};LateRunner.touchRadius=42;LateRunner.gameOffset=new Vector(0,0);var b=document.getElementById("gameCanvas");this.context=b.getContext("2d");this.setupGameModel(a);this.setupGameViews();LateRunner.resizeController=new ResizeController(a);LateRunner.resizeController.resizeGame();LateRunner.playerController=new PlayerController(a);LateRunner.userInputController=new UserInputController(a);LateRunner.doorAndSwitchController=new DoorAndSwitchController(a);LateRunner.levelChangeController=new LevelChangeController(a);LateRunner.bossController=new BossController(a);LateRunner.subtitleController=new SubtitleController(a);LateRunner.timerController=new TimerController(new TimerModel());this.gameLoop()},setupGameModel:function(a){console.log("GameController::setupGameModel");a.touchRadius=42;a.levels=ModelFactory.createLevels(LateRunner.LevelData);a.currentLevelIndex=0;a.currentLevel=a.levels[a.currentLevelIndex];a.player=new PlayerModel();a.boss=new BossModel();this.gameModel=a},setupGameViews:function(){LateRunner.backgroundColour=rgbObjToHexColourString(this.gameModel.backgroundColour);new LevelView(this.gameModel.currentLevel,this.context);this.setupSwitchViews();console.log(this.gameModel.currentLevel);if(this.gameModel.currentLevel.boss){new BossView(this.gameModel.boss,this.context)}else{new StairsView(this.gameModel.currentLevel.stairs,this.context)}new PlayerView(this.gameModel.player,this.context);this.setupDoorViews();new SubtitleView(this.gameModel)},setupDoorViews:function(){for(i=0;i<this.gameModel.currentLevel.doors.length;i++){new DoorView(this.gameModel.currentLevel.doors[i],this.context)}},setupSwitchViews:function(){for(i=0;i<this.gameModel.currentLevel.switches.length;i++){new SwitchView(this.gameModel.currentLevel.switches[i],this.context)}},gameLoop:function(){this.context.clearRect(0,0,this.gameModel.width,this.gameModel.height);if(this.gameModel.levelTransitioningOut){LateRunner.levelChangeController.transitionGameOut()}else{if(this.gameModel.levelTransitioningIn){LateRunner.levelChangeController.transitionGameIn()}}LateRunner.events.emit("update");LateRunner.events.emit("render");window.requestAnimFrame((this.gameLoop).bind(this),this)}};function LevelChangeController(a){this.model=a;LateRunner.events.on("stairsReached",this.startLevelTransitionOut,this)}LevelChangeController.prototype={startLevel:function(a){this.model.currentLevelIndex=a;this.model.currentLevel=this.model.levels[this.model.currentLevelIndex];LateRunner.events.emit("destroyViews");LateRunner.game.setupGameViews();LateRunner.resizeController.resizeGame();LateRunner.playerController.resetPosition();LateRunner.doorAndSwitchController.resetDoors();console.log(!!this.model.currentLevel.boss);if(this.model.currentLevel.boss){this.model.currentSubtitle=""}else{this.model.currentSubtitle=LateRunner.subtitleController.getNewSubtitle()}},startLevelTransitionOut:function(){this.model.levelTransitioningOut=true},startLevelTransitionIn:function(){LateRunner.gameOffset.y=-this.model.height;this.model.levelTransitioningIn=true;this.model.levelTransitioningOut=false},transitionGameOut:function(){if(this.model.currentLevelIndex+1<this.model.levels.length){if(LateRunner.gameOffset.y<this.model.height){LateRunner.gameOffset.y+=this.model.levelTransitionSpeed}else{this.startLevel(this.model.currentLevelIndex+1);this.startLevelTransitionIn()}}},transitionGameIn:function(){if(LateRunner.gameOffset.y<0){LateRunner.gameOffset.y+=this.model.levelTransitionSpeed}else{LateRunner.gameOffset.y=0;LateRunner.events.emit("levelStarted")}}};var ModelFactory={};ModelFactory.createLevels=function(b){console.log("ModelFactory::generateLevelModels");var a,d=[],c;for(a=0;a<b.levels.length;a++){b.levels[a].doors=ModelFactory.createDoorModels(a,b);b.levels[a].switches=ModelFactory.createSwitchModels(a,b);c=new LevelModel(a,b.levels[a]);d.push(c)}return d};ModelFactory.createDoorModels=function(e,b){var a,c=[],d;for(a=0;a<b.levels[e].doors.length;a++){d=this.createDoorModel(b.levels[e].doors[a]);d.id=a;c.push(d)}return c};ModelFactory.createDoorModel=function(a){return new DoorModel(a)};ModelFactory.createSwitchModels=function(f,c){var b,e=[],d,a=[];for(b=0;b<c.levels[f].switches.length;b++){d=c.levels[f].switches[b].connectedDoors;a=[];for(j=0;j<d.length;j++){a.push(c.levels[f].doors[d[j]])}c.levels[f].switches[b].connectedDoors=a;e.push(new SwitchModel(b,c.levels[f].switches[b]))}return e};function PlayerController(a){this.model=a;this.player=a.player;this.resetPosition();this.setupAnimationFrames();LateRunner.events.on("update",this.update,this);LateRunner.events.on("moveToObject",this.onMoveToObject,this)}PlayerController.prototype={resetPosition:function(){this.player.position=new Vector(this.model.width/14*LateRunner.sizeMultiple,this.model.height)},setupAnimationFrames:function(){this.player.imageObject.src=LateRunner.AnimData.player.filename;this.player.runFrames={right:LateRunner.AnimData.player.run.right.frames,left:LateRunner.AnimData.player.run.left.frames};this.player.currentFrameIndex=0},update:function(){if(this.player.moveDirection==LateRunner.directions.RIGHT){if(this.player.position.x<this.player.targetX){this.player.position.x+=this.player.moveSpeed;this.player.currentFrame=this.player.runFrames.right[Math.ceil(this.player.currentFrameIndex)];this.player.currentFrameIndex=(this.player.currentFrameIndex+0.5)%(this.player.runFrames.left.length-1)}else{this.player.position.x=this.player.targetX;this.player.lastMoveDirection=LateRunner.directions.RIGHT;this.player.moveDirection=LateRunner.directions.STILL;this.onTargetObjectReached()}}else{if(this.player.moveDirection==LateRunner.directions.LEFT){if(this.player.position.x>this.player.targetX){this.player.position.x-=this.player.moveSpeed;this.player.currentFrame=this.player.runFrames.left[Math.ceil(this.player.currentFrameIndex)];this.player.currentFrameIndex=(this.player.currentFrameIndex+0.5)%(this.player.runFrames.left.length-1)}else{this.player.position.x=this.player.targetX;this.player.lastMoveDirection=LateRunner.directions.LEFT;this.player.moveDirection=LateRunner.directions.STILL;this.onTargetObjectReached()}}else{if(this.player.lastMoveDirection==LateRunner.directions.RIGHT){this.player.currentFrame=this.player.runFrames.right[3]}else{if(this.player.lastMoveDirection==LateRunner.directions.LEFT){this.player.currentFrame=this.player.runFrames.left[3]}}}}},onMoveToObject:function(a){if(LateRunner.doorAndSwitchController.doorIsClosedBetween(this.player.position,a.position){return}this.player.targetX=(a.numberOfSteps)?a.position.x+a.width/2:a.position.x;this.player.targetObject=a;this.player.targetX-=this.player.currentFrame.w*LateRunner.sizeMultiple;if(this.player.targetX>this.player.position.x){this.player.moveDirection=LateRunner.directions.RIGHT}else{if(this.player.targetX<this.player.position.x){this.player.moveDirection=LateRunner.directions.LEFT}else{this.onTargetObjectReached()}}},onTargetObjectReached:function(){if(this.player.targetObject.numberOfSteps){LateRunner.events.emit("stairsReached")}else{this.player.lastMoveDirection=LateRunner.directions.RIGHT;LateRunner.events.emit("switchActivated",this.player.targetObject)}this.player.targetObject=null}};function ResizeController(a){this.gameModel=a;window.onresize=this.resizeGame.bind(this)}ResizeController.prototype={resizeGame:function(){var c=document.getElementById("gameCanvas"),a=document.getElementById("canvasContainer"),b=document.getElementById("subtitles");c.width=a.clientWidth;c.height=c.width/3.85;a.style.marginTop=-c.height/2;a.style.marginLeft=-c.width/2;b.style.width=c.width;this.gameModel.prevWidth=this.gameModel.width||0;this.gameModel.prevHeight=this.gameModel.height||0;this.gameModel.height=this.gameModel.currentLevel.height=c.height;this.gameModel.width=this.gameModel.currentLevel.width=c.width;LateRunner.pixelSize=c.height*0.02;LateRunner.sizeMultiple=mapValue(LateRunner.pixelSize,0,4,0,1);LateRunner.touchRadius=42*LateRunner.sizeMultiple;this.resizeLevel(this.gameModel.width,this.gameModel.height);this.resizePlayer(this.gameModel.width,this.gameModel.height);this.resizeBoss(this.gameModel.width,this.gameModel.height)},resizeLevel:function(b,a){var c=this.gameModel.currentLevel;c.width=b;c.height=a;this.resizeStairs(b,a);this.resizeDoors(b,a);this.resizeSwitches(b,a);this.gameModel.levelTransitionSpeed=this.gameModel.originalLevelTransitionSpeed*LateRunner.sizeMultiple},resizeDoors:function(c,b){var e=this.gameModel.currentLevel,a,d;for(a=0;a<e.doors.length;a++){d=e.doors[a];d.height=b;d.width=d.openSegmentHeight=LateRunner.pixelSize*4;if(d.originalPosition){d.position=new Vector(mapValue(d.originalPosition.x,0,770,c/10,c-c/10),0)}else{d.position=new Vector(mapValue(a+1,0,e.doors.length+1,c/10,c-c/10),0)}}},resizeSwitches:function(c,e){var b=this.gameModel.currentLevel,h,g,k,f,a=new Array(b.doors.length),d;for(h=0;h<b.doors.length;h++){k=[];for(g=0;g<b.switches.length;g++){if(b.switches[g].doorPosition==h){k.push(b.switches[g])}}a[h]=k}for(h=0;h<b.doors.length;h++){for(g=0;g<a[h].length;g++){f=a[h][g];d=mapValue(g+1,0,a[h].length+1,e/10,e-(e/10));f.radius=LateRunner.pixelSize*2;f.position=new Vector(b.doors[h].position.x-LateRunner.touchRadius,d)}}},resizeStairs:function(c,a){var d=this.gameModel.currentLevel,b=d.stairs;if(!!d.stairs){b.stepHeight=a/b.numberOfSteps;b.width=LateRunner.pixelSize*24;b.height=a;b.position.x=c-b.width}},resizePlayer:function(c,b){var a=this.gameModel.player;a.position=new Vector(mapValue(a.position.x,0,this.gameModel.prevWidth,0,c),b);a.moveSpeed=a.originalMoveSpeed*LateRunner.sizeMultiple},resizeBoss:function(c,b){var a=this.gameModel.boss;a.position=new Vector(mapValue(600,0,770,0,c),b)}};function SubtitleController(a){this.model=a;this.setupSubtitles();LateRunner.events.on("timeTick",this.onTimeTick,this);LateRunner.events.on("seenByBoss",this.onSeenByBoss,this)}SubtitleController.prototype={setupSubtitles:function(){this.model.playerSubtitles=LateRunner.SubtitleData.playerThoughts;this.model.bossSpeech=LateRunner.SubtitleData.bossSpeech;this.model.currentSubtitle=this.model.playerSubtitles[0]},onTimeTick:function(){if(this.model.currentLevelIndex!=0&&!this.model.currentLevel.boss){if(Math.random()>0.8){this.model.currentSubtitle=this.getNewSubtitle();console.log(this.model.currentSubtitle)}}},getNewSubtitle:function(){return this.model.playerSubtitles[randomInt(0,this.model.playerSubtitles.length-1)]},getBossSubtitle:function(){console.log(this.model.bossSpeech);console.log(this.model.timeUp);return this.model.bossSpeech[this.model.timeUp?1:0]},onSeenByBoss:function(){this.model.currentSubtitle=this.getBossSubtitle()}};function TimerController(a){this.model=a;this.model.startTime=new Date().getTime()/1000;new TimerView(this.model);LateRunner.events.on("update",this.update,this)}TimerController.prototype={update:function(){var b=new Date().getTime()/1000,a=(b-this.model.startTime);if(Math.floor(a)>0&&this.model.timing){this.model.startTime=b;this.updateTime()}},updateTime:function(){LateRunner.events.emit("timeTick");this.model.seconds=(this.model.seconds+60-1)%60;if(this.model.seconds==59){this.model.minutes--;if(this.model.minutes<0){LateRunner.events.emit("timeup");this.onTimeUp();this.model.timing=false}}},onTimeUp:function(){this.model.timeUp=true},getTimeLeftAsString:function(){return this.model.timing?padNumber(this.model.minutes,2)+":"+padNumber(this.model.seconds,2):"YOU'RE LATE"}};function UserInputController(a){this.model=a;document.getElementById("gameCanvas").onclick=this.onCanvasClicked.bind(this);document.onkeypress=this.onKeyPressed.bind(this)}UserInputController.prototype={onCanvasClicked:function(a){var c=a.target.getBoundingClientRect(),b=this.getClickedObject(a.clientX-c.left,a.clientY-c.top);if(b){LateRunner.events.emit("moveToObject",b)}},getClickedObject:function(a,d){var c,b;for(c=0;c<this.model.currentLevel.switches.length;c++){b=this.model.currentLevel.switches[c];if(coordinateWasTouched(b.position.x,b.position.y,a,d)){return b}}if(this.model.currentLevel.stairs&&a>this.model.width-this.model.currentLevel.stairs.width){return this.model.currentLevel.stairs}return null},onKeyPressed:function(a){var b=window.event?a.keyCode:a.which?a.which:null;if(b){b=String.fromCharCode(b)}switch(b){case"u":if(this.model.currentLevelIndex+1<this.model.levels.length){LateRunner.levelChangeController.startLevel(this.model.currentLevelIndex+1)}break;case"d":if(this.model.currentLevelIndex-1>=0){LateRunner.levelChangeController.startLevel(this.model.currentLevelIndex-1)}break}}};LateRunner.AnimData={player:{filename:"images/player.png",run:{right:{frames:[{x:222,y:0,w:111,h:150},{x:212,y:150,w:101,h:150},{x:162,y:450,w:71,h:150},{x:264,y:610,w:41,h:160},{x:213,y:600,w:51,h:160},{x:81,y:590,w:81,h:160},{x:0,y:440,w:91,h:150},{x:101,y:300,w:101,h:140},{x:0,y:150,w:111,h:150}]},left:{frames:[{x:0,y:0,w:111,h:150},{x:111,y:150,w:101,h:150},{x:91,y:440,w:71,h:150},{x:264,y:450,w:41,h:160},{x:162,y:600,w:51,h:160},{x:0,y:590,w:81,h:160},{x:202,y:300,w:91,h:150},{x:0,y:300,w:101,h:140},{x:111,y:0,w:111,h:150}]}}},boss:{filename:"images/boss.png",stand:{frames:[{x:0,y:0,w:90,h:150}]},talk:{frames:[{x:0,y:150,w:90,h:150},{x:0,y:300,w:90,h:150}]}}};LateRunner.LevelData={levels:[{switches:[{connectedDoors:[0],doorPosition:0}],doors:[{state:"closed"}]},{switches:[{connectedDoors:[0],doorPosition:0},{connectedDoors:[1],doorPosition:1}],doors:[{state:"closed"},{state:"closed"}]},{switches:[{connectedDoors:[1],doorPosition:0},{connectedDoors:[0],doorPosition:0}],doors:[{state:"closed"},{state:"closed"}]},{switches:[{connectedDoors:[0,1],doorPosition:0},{connectedDoors:[1,0],doorPosition:1}],doors:[{state:"closed"},{state:"open"}]},{switches:[{connectedDoors:[0,2],doorPosition:0},{connectedDoors:[0],doorPosition:1},{connectedDoors:[0,1],doorPosition:1},{connectedDoors:[0],doorPosition:2}],doors:[{state:"closed"},{state:"closed"},{state:"open"}]},{switches:[{connectedDoors:[0,1],doorPosition:0},{connectedDoors:[1],doorPosition:1},{connectedDoors:[0,3],doorPosition:1},{connectedDoors:[2],doorPosition:2},{connectedDoors:[3],doorPosition:3}],doors:[{state:"open"},{state:"closed"},{state:"open"},{state:"open"}]},{boss:true,switches:[{connectedDoors:[0],doorPosition:0}],doors:[{state:"closed"}]}]};LateRunner.SubtitleData={playerThoughts:["God, I'm so late.","Why does this office have so many doors?","I'm always late.","The boss is gonna kill me.","Who invented this ridiculous door system?","I wish the lift wasn't broken.","Who schedules a meeting on the top floor?","I wonder what the time is.","Did I leave the oven on?","This would never have happened if Julia was still around.","I wish I'd had time to iron my trousers.","I wish I'd had time to iron my shirt.","I wish I'd had time to put on a tie.","I wish I'd had time for breakfast.","I wish Julia hadn't left me.","I wish I'd worked harder this week.","I wish I'd worked harder this month.","I wish I'd worked harder this year.","I wish I'd worked harder in this job.","I hate my job.","I wish I was a programmer."],bossSpeech:['"Jeff, you\'re a lousy employee and fired!"','"Jeff, you\'re a lousy employee and late and fired!"']};function Vector(a,b){this.x=a;this.y=b}function BossModel(){this.position=new Vector(500,0);this.imageObject=new Image();this.currentFrame={x:0,y:0,w:0,h:0};this.animIndex=0}function DoorModel(a){this.id=-1;this.originalState=this.state=a.state;this.originalPosition=a.originalPosition}function GameModel(){this.position=new Vector(0,0);this.levels=[];this.player;this.levelTransitioningIn=false;this.levelTransitioningOut=false;this.originalLevelTransitionSpeed=5;this.backgroundColour={r:17,g:17,b:17};this.pixelSize=4;this.sizeMultiple=1}function LevelModel(a,b){this.id=a;this.switches=b.switches;this.doors=b.doors;if(b.boss){this.boss=b.boss}else{this.stairs=new StairsModel()}this.position=new Vector(0,0);this.backgroundColour={r:17,g:17,b:17}}function PlayerModel(){this.position=new Vector(0,0);this.targetPosition=new Vector(0,0);this.moveDirection=0;this.originalMoveSpeed=7;this.lastMoveDirection=1;this.imageObject=new Image();this.currentFrame={x:0,y:0,w:0,h:0}}function StairsModel(){this.position=new Vector(0,0);this.numberOfSteps=6}function SwitchModel(a,b){this.id=a;this.connectedDoors=b.connectedDoors;this.doorPosition=b.doorPosition;this.originalPosition=b.originalPosition;this.radius=2}function TimerModel(){this.minutes=5;this.seconds=0;this.timing=true}function BossView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this);LateRunner.events.on("destroyViews",this.destroy,this)}BossView.prototype={render:function(){this.context.drawImage(this.model.imageObject,this.model.currentFrame.x,this.model.currentFrame.y,this.model.currentFrame.w,this.model.currentFrame.h,LateRunner.gameOffset.x+this.model.position.x-this.model.currentFrame.w/2*LateRunner.sizeMultiple,LateRunner.gameOffset.y+this.model.position.y-this.model.currentFrame.h*LateRunner.sizeMultiple,this.model.currentFrame.w*LateRunner.sizeMultiple,this.model.currentFrame.h*LateRunner.sizeMultiple)},destroy:function(a){LateRunner.events.off("render",this.render);delete this}};function DoorView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this);LateRunner.events.on("destroyViews",this.destroy,this)}DoorView.prototype={render:function(){this.context.fillStyle=LateRunner.backgroundColour;if(this.model.state=="closed"){this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x,LateRunner.gameOffset.y+this.model.position.y,this.model.width,this.model.height)}else{this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x,LateRunner.gameOffset.y+this.model.position.y,this.model.width,this.model.openSegmentHeight);this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x,LateRunner.gameOffset.y+this.model.position.y+this.model.height-this.model.openSegmentHeight,this.model.width,this.model.openSegmentHeight)}},destroy:function(){LateRunner.events.off("render",this.render);delete this}};function LevelView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this);LateRunner.events.on("destroyViews",this.destroy,this)}LevelView.prototype={render:function(){this.context.fillStyle="#FFFFFF";var b=LateRunner.gameOffset.x+this.model.position.x,a=LateRunner.gameOffset.y+this.model.position.y;this.context.fillRect(b,a,this.model.width,3*this.model.height/5);this.context.fillStyle="#EEEEEE";this.context.fillRect(b,a+3*this.model.height/5,this.model.width,2*this.model.height/5)},destroy:function(a){LateRunner.events.off("render",this.render);delete this}};function PlayerView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this)}PlayerView.prototype={render:function(){this.context.drawImage(this.model.imageObject,this.model.currentFrame.x,this.model.currentFrame.y,this.model.currentFrame.w,this.model.currentFrame.h,LateRunner.gameOffset.x+this.model.position.x-this.model.currentFrame.w/2*LateRunner.sizeMultiple,LateRunner.gameOffset.y+this.model.position.y-this.model.currentFrame.h*LateRunner.sizeMultiple,this.model.currentFrame.w*LateRunner.sizeMultiple,this.model.currentFrame.h*LateRunner.sizeMultiple);this.context.fillStyle="#FF0000"},destroy:function(a){LateRunner.events.off("render",this.render);delete this}};function StairsView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this);LateRunner.events.on("destroyViews",this.destroy,this)}StairsView.prototype={render:function(){for(i=0;i<this.model.numberOfSteps;i++){var a=hexColourStringToRgbObj(LateRunner.backgroundColour),b=rgbObjToHexColourString({r:Math.ceil(mapValue(i,0,this.model.numberOfSteps-1,a.r,255)),g:Math.ceil(mapValue(i,0,this.model.numberOfSteps-1,a.g,255)),b:Math.ceil(mapValue(i,0,this.model.numberOfSteps-1,a.b,255))});this.context.fillStyle=b;this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x,LateRunner.gameOffset.y+this.model.height-((i+1)*this.model.stepHeight),this.model.width,this.model.stepHeight)}this.context.fillStyle=LateRunner.backgroundColour;this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x-this.model.pixelSize,LateRunner.gameOffset.y+this.model.position.y,this.model.pixelSize,this.model.height)},destroy:function(a){LateRunner.events.off("render",this.render);delete this}};function SubtitleView(a){this.model=a;LateRunner.events.on("render",this.render,this);this.element=document.getElementById("subtitles")}SubtitleView.prototype={render:function(){this.element.innerHTML=this.model.currentSubtitle}};function SwitchView(a,b){this.model=a;this.context=b;LateRunner.events.on("render",this.render,this);LateRunner.events.on("destroyViews",this.destroy,this)}SwitchView.prototype={render:function(){this.context.fillStyle=LateRunner.backgroundColour;this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x-this.model.radius,LateRunner.gameOffset.y+this.model.position.y-(this.model.radius/2),this.model.radius*2,this.model.radius);this.context.fillRect(LateRunner.gameOffset.x+this.model.position.x-(this.model.radius/2),LateRunner.gameOffset.y+this.model.position.y-this.model.radius,this.model.radius,this.model.radius*2)},destroy:function(){LateRunner.events.off("render",this.render);delete this}};function TimerView(a){this.model=a;LateRunner.events.on("render",this.render,this);this.element=document.getElementById("timer")}TimerView.prototype={render:function(){this.element.innerHTML=LateRunner.timerController.getTimeLeftAsString()}};